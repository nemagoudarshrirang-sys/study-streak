<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Study Streak</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">

<!-- ‚úÖ GOOGLE ANALYTICS (DO NOT TOUCH) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D7J2BNQYDN"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-D7J2BNQYDN');
</script>

<style>
:root {
  --font-size-base: 14px;
  --line-height-base: 1.6;
  --theme-variant: 'soft-dark';
}
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: "Segoe UI", system-ui, sans-serif;
  font-size: var(--font-size-base);
  line-height: var(--line-height-base);
}

body {
  min-height: 100vh;
  background: radial-gradient(circle at top, #0f172a, #020617);
  color: #e5e7eb;
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 1.6;
}
.shell{width:360px;display:flex;flex-direction:column;gap:14px;padding:20px 0 80px 0}
.topbar{height:48px;display:flex;align-items:center;gap:12px;padding:0 4px}
.search{flex:1;background:rgba(26,26,26,0.8);border:none;border-radius:24px;height:40px;color:#e5e7eb;padding:0 16px;font-size:14px;backdrop-filter:blur(8px);transition:background 0.2s ease}
.search:focus{outline:none;background:rgba(30,30,30,0.9)}
.avatars{display:flex;gap:12px;padding:8px 4px}
.av{width:44px;height:44px;border-radius:50%;background:rgba(26,26,26,0.8);display:flex;align-items:center;justify-content:center;font-weight:700;position:relative;backdrop-filter:blur(8px);transition:transform 0.15s ease}
.av:hover{transform:scale(1.05)}
.dot{position:absolute;bottom:2px;right:2px;width:10px;height:10px;border-radius:50%;background:#22c55e;box-shadow:0 0 8px rgba(34,197,94,0.4)}
.bottom-nav{position:fixed;left:0;right:0;bottom:0;height:64px;background:rgba(17,17,17,0.95);border-top:1px solid rgba(255,255,255,0.08);display:flex;align-items:center;justify-content:space-around;z-index:50;backdrop-filter:blur(12px)}
.bn-btn{background:transparent;border:none;color:#e5e7eb;font-size:20px;cursor:pointer;opacity:0.85;transition:opacity 0.2s ease, transform 0.15s ease;padding:8px}
.bn-btn:hover{opacity:1;transform:scale(1.1)}
.bn-btn.active{color:#22c55e;opacity:1}

/* ---------- LOGIN ---------- */
.login-screen {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: radial-gradient(circle at top, #020617, #000);
  z-index: 1000;
}

.login-card {
  width: 320px;
  padding: 28px;
  border-radius: 20px;
  background: rgba(15,23,42,0.9);
  text-align: center;
  box-shadow: 0 25px 60px rgba(0,0,0,0.8);
}

.login-card h1 {
  font-size: 24px;
  margin-bottom: 6px;
}

.login-card p {
  font-size: 14px;
  color: #94a3b8;
  margin-bottom: 20px;
}

.login-btn {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: none;
  font-weight: 600;
  cursor: pointer;
  background: #fff;
  color: #111;
}

/* ---------- APP ---------- */
.card {
  width: 340px;
  padding: 32px 28px;
  border-radius: 24px;
  text-align: center;
  background: rgba(26,26,26,0.85);
  backdrop-filter: blur(16px);
  box-shadow: 
    0 0 0 1px rgba(255,255,255,0.06),
    0 20px 40px rgba(0,0,0,0.4);
}

h2 { font-size: 28px; font-weight: 700; letter-spacing: -0.5px; }
.subtitle { font-size: 14px; color: #94a3b8; margin: 8px 0 24px; line-height: 1.5; }
.timer { font-size: 56px; font-weight: 700; margin-bottom: 24px; letter-spacing: -1px; }
.row { display:flex; gap:10px; justify-content:center; margin:12px 0; }
.mini-btn { padding:10px 16px; border:none; border-radius:14px; background:rgba(51,65,85,0.8); color:#e5e7eb; cursor:pointer; font-size:13px; font-weight:500; transition:all 0.2s ease; }
.mini-btn:hover { background:rgba(51,65,85,1); transform:translateY(-1px); }
.mini-btn.on { background:#22c55e; color:#0b1a12; box-shadow:0 2px 8px rgba(34,197,94,0.3); }
.input-soft { width:100%; padding:12px 14px; border:none; border-radius:14px; background:rgba(11,18,32,0.8); color:#e5e7eb; font-size:14px; }
.break-box { margin-top:16px; background:rgba(2,6,23,0.6); padding:14px; border-radius:14px; display:none; backdrop-filter:blur(8px); }
.break-title { font-size:13px; color:#94a3b8; margin-bottom:8px; text-align:center; }
.progress { margin-top:18px; background:rgba(2,6,23,0.6); padding:14px; border-radius:14px; backdrop-filter:blur(8px); }
.progress .title { font-size:13px; color:#94a3b8; margin-bottom:8px; text-align:center; }
.bars { display:flex; gap:8px; justify-content:center; align-items:flex-end; height:44px; }
.bar { width:12px; border-radius:8px; background:rgba(51,65,85,0.6); transition:background 0.3s ease; }
.active-focus { box-shadow: 0 0 0 2px rgba(34,197,94,0.4), 0 0 24px rgba(34,197,94,0.25); }
button:active { transform: scale(0.97); }

.buttons {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin-bottom: 20px;
}

button {
  padding: 12px 20px;
  border-radius: 14px;
  border: none;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  letter-spacing: 0.3px;
}

button:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

.start { background: #22c55e; color: #0b1a12; }
.start:hover { box-shadow: 0 4px 16px rgba(34,197,94,0.4); }
.pause { background: #facc15; color: #422006; }
.pause:hover { box-shadow: 0 4px 16px rgba(250,204,21,0.3); }
.reset { background: #ef4444; color: #fff; }
.reset:hover { box-shadow: 0 4px 16px rgba(239,68,68,0.3); }

.status { font-size: 14px; margin-top: 8px; color: #cbd5e1; }
.streak { margin-top: 12px; font-size: 14px; color: #e5e7eb; font-weight: 500; }
.today { margin-top: 8px; font-size: 13px; color: #cbd5e1; }
.reminder { margin-top: 10px; font-size: 13px; color: #94a3b8; min-height: 18px; line-height: 1.5; }

.nav {
  margin-top: 18px;
  display: flex;
  gap: 10px;
  justify-content: center;
}

.nav button {
  background: rgba(51,65,85,0.8);
  color: #e5e7eb;
  padding: 10px 16px;
  border-radius: 12px;
  font-size: 13px;
  font-weight: 500;
  transition: all 0.2s ease;
}

.nav button:hover {
  background: rgba(51,65,85,1);
  transform: translateY(-1px);
}

.focus-hub {
  margin-top: 16px;
  width: 100%;
  background: rgba(31,41,55,0.8);
  color: #e5e7eb;
  padding: 12px 14px;
  border-radius: 14px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  backdrop-filter: blur(8px);
}

.focus-hub:hover {
  background: rgba(31,41,55,1);
  transform: translateY(-1px);
}

.logout {
  margin-top: 12px;
  background: #111827;
  width: 100%;
}
.calm-mode { filter: brightness(0.9) saturate(0.9); }
.mood-overlay{position:fixed;inset:0;background:rgba(2,6,23,0.94);display:none;align-items:center;justify-content:center;z-index:2000;backdrop-filter:blur(8px)}
.mood-card{width:340px;background:rgba(15,23,42,0.95);padding:28px;border-radius:24px;text-align:center;backdrop-filter:blur(16px);box-shadow:0 20px 40px rgba(0,0,0,0.5)}
.mood-title{font-size:20px;margin-bottom:12px;font-weight:600;letter-spacing:-0.3px}
.mood-btn{width:100%;margin-top:10px;padding:12px;border:none;border-radius:14px;background:rgba(51,65,85,0.8);color:#e5e7eb;cursor:pointer;font-size:14px;font-weight:500;transition:all 0.2s ease}
.mood-btn:hover{background:rgba(51,65,85,1);transform:translateY(-1px)}
.session-summary{position:fixed;inset:0;background:rgba(2,6,23,0.95);display:flex;align-items:center;justify-content:center;z-index:1500;backdrop-filter:blur(8px)}
.session-summary-content{background:rgba(15,23,42,0.95);padding:32px;border-radius:24px;text-align:center;max-width:320px;backdrop-filter:blur(16px);box-shadow:0 20px 40px rgba(0,0,0,0.5)}
.session-summary-text{font-size:16px;color:#e5e7eb;margin-bottom:20px;line-height:1.6}
.session-summary-close{background:rgba(51,65,85,0.8);color:#e5e7eb;border:none;border-radius:12px;padding:10px 20px;cursor:pointer;font-size:14px;font-weight:500;transition:all 0.2s ease}
.session-summary-close:hover{background:rgba(51,65,85,1);transform:translateY(-1px)}
</style>
</head>

<body>

<!-- LOGIN SCREEN removed to make dashboard first UI -->

<!-- APP -->
<div class="shell">
  <div class="topbar">
    <input id="homeSearch" class="search" placeholder="Search or ask‚Ä¶" />
  </div>
  <div class="avatars" id="homeAvatars"></div>
  <div class="card" id="app">
  <h2>Study Streak</h2>
  <div class="subtitle">25 minutes. No excuses.</div>

  <div class="timer" id="timer">25:00</div>

  

  <div class="buttons">
    <button class="start" id="startBtn">Start</button>
    <button class="pause" id="pauseBtn">Pause</button>
    <button class="reset" id="resetBtn">Reset</button>
    <button class="reset" id="addFiveBtn" style="display:none">+5 min</button>
  </div>

  <div class="status" id="status">Not started</div>
  <div class="streak" id="streak">Streak: 0</div>
  <div class="today">üìò Today: <span id="todaySessions">0</span></div>
  <div class="reminder" id="gentleReminder"></div>

  <div class="row" style="margin-top:10px">
    <button class="mini-btn" id="shieldBtn">Focus Shield</button>
  </div>
  <div class="today" id="focusShieldInfo"></div>

  <div class="nav">
    <button onclick="location.href='notes.html'">üìù Notes</button>
    <button onclick="location.href='history.html'">üìä History</button>
  </div>

  <button class="focus-hub" onclick="location.href='focus.html'">
    ‚öôÔ∏è Focus Hub
  </button>

  <button class="focus-hub" onclick="location.href='todays-plan.html'">
    üóìÔ∏è Today‚Äôs Plan
  </button>
</div>
  <div class="bottom-nav">
    <button class="bn-btn active" onclick="location.href='index.html'">üè†</button>
    <button class="bn-btn" onclick="location.href='group-inbox.html'">üí¨</button>
    <button class="bn-btn" onclick="location.href='profile.html'">üôÇ</button>
    <button class="bn-btn" onclick="location.href='settings.html'">‚öôÔ∏è</button>
  </div>
</div>

<div class="mood-overlay" id="moodOverlay">
  <div class="mood-card">
    <div class="mood-title">Choose study mood</div>
    <button class="mood-btn" data-mood="Calm">Calm üåø</button>
    <button class="mood-btn" data-mood="Neutral">Neutral ‚òÅÔ∏è</button>
    <button class="mood-btn" data-mood="Deep">Deep Focus üîï</button>
    <button class="mood-btn" data-mood="Low">Low Energy üåô</button>
  </div>
</div>

<!-- LOGIN LOGIC removed -->

<!-- ‚úÖ SINGLE SOURCE OF TRUTH -->
<script src="env.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>
<script>
  const firebaseConfig = {
    apiKey: window.__FIREBASE_CONFIG.apiKey,
    authDomain: window.__FIREBASE_CONFIG.authDomain,
    projectId: window.__FIREBASE_CONFIG.projectId
  };
  try{
    if(!firebase.apps.length){
      firebase.initializeApp(firebaseConfig);
    }
    window.fdb = firebase.firestore();
    if(localStorage.getItem('calmMode')==='on'){
      document.body.classList.add('calm-mode');
    }
    // First UI is the dashboard; unauthenticated users are allowed
  }catch(e){
    console.warn("Firebase init error", e);
  }
</script>
<script src="script.js"></script>
<script src="core/soundscape.js"></script>
<script src="core/timer-visuals.js"></script>
<script src="core/growth-indicator.js"></script>
<script>
// Apply font size and line spacing from settings
(function(){
  const fontSize = localStorage.getItem('fontSize') || 'medium';
  const sizes = { small: '13px', medium: '14px', large: '16px' };
  document.documentElement.style.setProperty('--font-size-base', sizes[fontSize] || sizes.medium);
  const lineSpacing = localStorage.getItem('lineSpacing') || 'comfortable';
  const spacings = { tight: '1.4', comfortable: '1.6', spacious: '1.8' };
  document.documentElement.style.setProperty('--line-height-base', spacings[lineSpacing] || spacings.comfortable);
  const themeVariant = localStorage.getItem('themeVariant') || 'soft-dark';
  if(themeVariant==='blue-dark'){
    document.documentElement.style.setProperty('--bg-gradient-start', '#1e3a5f');
    document.documentElement.style.setProperty('--bg-gradient-end', '#0a1a2e');
  }else if(themeVariant==='warm-dark'){
    document.documentElement.style.setProperty('--bg-gradient-start', '#2d1b1b');
    document.documentElement.style.setProperty('--bg-gradient-end', '#1a0f0f');
  }
})();
// mood overlay integration
const overlay = document.getElementById('moodOverlay');
const startBtn = document.getElementById('startBtn');
let originalStart = null;
document.querySelectorAll('.mood-btn').forEach(btn=>{
  btn.onclick = ()=>{
    const mood = btn.getAttribute('data-mood');
    localStorage.setItem('sessionMood', mood);
    overlay.style.display='none';
  };
});
// Avatars from recent groups (local hint)
(function(){
  try{
    const avs = document.getElementById("homeAvatars");
    if(!avs) return;
    const codes = [];
    const saved = localStorage.getItem("groupCode");
    if(saved) codes.push(saved);
    const names = (localStorage.getItem("subjects")||"").split(",").filter(Boolean).slice(0,6);
    const base = [...codes, ...names];
    base.slice(0,6).forEach(n=>{
      const d = document.createElement("div");
      d.className = "av";
      d.textContent = (n||"?")[0].toUpperCase();
      const dot = document.createElement("div"); dot.className="dot"; d.appendChild(dot);
      d.title = n;
      avs.appendChild(d);
    });
  }catch(e){}
})();
</script>

</body>
</html>
